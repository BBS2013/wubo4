# linux是怎么工作的

# 第一部分

## 1.Linux系统

![image-20231026202851964](D:\github\学习记录\linux how to work.assets\image-20231026202851964-1698323336947-1-1698323344114-3.png)

## 1.2linxu系统构成

<font color='orange'>Linux操作系统主要分为三层</font>。如图所示，最底层是硬件系统，包括内存和中央处理器（用于计算和从内存中读写数据），此外硬盘和网络接口也是硬件系统的一部分。

硬件系统之上是内核，它是操作系统的核心。内核是运行在内存中的软件，它向中央处理器发送指令。内核管理硬件系统，是硬件系统和应用程序之间进行通信的接口。

进程是指计算机中运行的所有程序，由内核统一管理，它们组成了最顶层，称为用户空间（userspace）。（另一个更确切的术语是用户进程，无论它们是否直接和用户交互。例如，所有的Web服务器都是以用户进程的形式运行的。）

## 1.3**内核和用户进程**之间最主要的区别是：

内核在内核模式（kernel mode）中运行，而用户进程则在用户模式（user mode）中运行。

在内核模式中运行的代码可以不受限地访问中央处理器和内存，这种模式功能强大，但也非常危险，因为内核进程可以轻而易举地使整个系统崩溃。那些只有内核可以访问的空间我们称为内核空间（kernelspace）。

相对于内核模式，用户模式对内存和中央处理器的访问有一定程度的限制，可访问的内存空间通常很小，对CPU的操作也很安全。用户空间指的是那些用户进程能够访问的内存空间。如果一个用户进程出错并崩溃的话，其导致的后果也相对有限，并且能够被内核清理掉。例如，如果你的Web浏览器崩溃了，不会影响到你正在运行的其他程序。



### 内核负责管理以下四个方面。

进程：内核决定哪个进程可以使用CPU。

内存：内核管理所有的内存，为进程分配内存，管理进程间的共享内存以及空闲内存。

设备驱动程序：作为硬件系统（如磁盘）和进程之间的接口，内核负责操控硬件设备。

系统调用和支持：进程通常使用系统调用和内核进行通信。



### 进程管理

进程管理涉及进程的启动、暂停、恢复和终止。

内核负责上下文切换。我们来看看下面的场景，以便理解它的工作原理。

1. CPU为每个进程计时，到时即停止进程，并切换至内核模式，由内核接管CPU控制权。
2. 内核记录下当前CPU和内存的状态信息，这些信息在恢复被停止的进程时需要用到。
3. 内核执行上一个时间段内的任务（如从输入输出设备获得数据，磁盘读写操作等）。
4. 内核准备执行下一个进程，从准备就绪的进程中选择一个执行。
5. 内核为新进程准备CPU和内存。
6. 内核将新进程执行的时间段通知CPU。7. 内核将CPU切换至用户模式，将CPU控制权移交给新进程。

内核是在什么时候运行的。答案就是，<font color='red'>**内核是在上下文切换时的时间段间隙中运行的**。</font>



### <font color='red'>内存管理</font>

内核在上下文切换过程中管理内存,

内核需要自己的专有内存空间，其他的用户进程无法访问；

每个用户进程有自己的专有内存空间；

一个进程不能访问另一个进程的专有内存空间；

用户进程之间可以共享内存；

用户进程的某些内存空间可以是只读的；

通过使用磁盘交换，系统可以使用比实际内存容量更多的内存空间。

新型的CPU提供了MMU（Memory Management Unit，内存管理单元），MMU使用了一种叫作虚拟内存的内存访问机制，即进程不是直接访问内存的实际物理地址，而是通过内核使得进程看起来可以使用整个系统的内存。当进程访问内存的时候，MMU截获访问请求，然后通过内存映射表将要访问的内存地址转换为实际的物理地址。内核需要初始化、维护和更新这个地址映射表。例如，在上下文切换时，<font color='orange'>内核将内存映射表从被移出进程转给被移入进程使用。</font>



### 系统调用和支持

当你在终端窗口中输入ls时，终端窗口中的shell调用fork()创建一个shell的副本，然后该副本调用exec(ls)来运行ls。

系统调用通常使用括号来标记。exec(ls)



### 用户空间：

内核分配给用户进程的内存我们称之为用户空间。因为一个进程简单说就是内存中的一个状态。用户空间也可以指所有用户进程占用的所有内存。



# 第二部分 

根据系统启动的大体顺序，更深入地介绍从设备管理到网络配置的各个部分。



# 第三部分

系统各部分的运行方式，并介绍一些基本技巧和常用的工具